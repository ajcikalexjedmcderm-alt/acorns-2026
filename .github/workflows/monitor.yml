name: Acorns Monitor

on:
  workflow_dispatch:      # å…è®¸æ‰‹åŠ¨æŒ‰é’®è§¦å‘
  schedule:
    - cron: '3,13,23,33,43,53 * * * *' # ä¿ç•™ä½œä¸ºå¤‡ç”¨ï¼Œè™½ç„¶ä¸å‡†
  repository_dispatch:    # ğŸ‘ˆ ã€æ–°å¢ã€‘å…è®¸å¤–éƒ¨é€šè¿‡ API è§¦å‘
    types: [trigger-scraper]

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install selenium requests

      - name: Run scraper
        id: scraper
        # å³ä½¿è„šæœ¬å‡ºé”™ä¹Ÿç»§ç»­ï¼Œç¡®ä¿èƒ½æäº¤é”™è¯¯æ—¥å¿—
        continue-on-error: true
        run: python acorns_scraper.py

      - name: Commit and push if changed
        # æ€»æ˜¯æ‰§è¡Œæäº¤æ­¥éª¤
        if: always()
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add acorns_data.json
          # å¦‚æœæ–‡ä»¶æ²¡å˜åŒ–ï¼ˆæ¯”å¦‚è„šæœ¬æŒ‚äº†ä¸”æ²¡å†™å…¥ï¼‰ï¼Œè¿™é‡Œä¼šè·³è¿‡ä¸æŠ¥é”™
          git commit -m "Auto-update holders data" || echo "No changes to commit"
          git push
